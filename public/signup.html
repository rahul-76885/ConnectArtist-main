<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Account</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">
    <!-- Back to Home Button (centered at top) -->
    <div class="w-full flex justify-center mt-4 absolute top-0 left-0 z-50">
        <a href="/frontend.html" class="inline-block bg-blue-500 text-white px-6 py-2 rounded-full shadow hover:bg-blue-600 transition font-semibold">
            &larr; Back to Home
        </a>
    </div>
    <!-- Navigation Bar -->
    <nav class="bg-white shadow-md p-4 w-full fixed top-0">
        <div class="container mx-auto flex justify-between items-center">
            <a href="/frontend.html" class="text-xl font-bold text-blue-500">ConnectArtist</a>
            <div class="space-x-4">
                <a href="/login.html" id="login-link" class="text-blue-500 hover:underline">Log In</a>
                <a href="#" id="logout-link" class="text-blue-500 hover:underline hidden">Log Out</a>
            </div>
        </div>
    </nav>

    <div class="bg-white p-8 rounded-lg shadow-lg w-full max-w-md mt-20">
        <h2 class="text-2xl font-bold mb-6 text-center">Create Account</h2>
        <p class="text-center text-gray-600 mb-6">Sign up in seconds with your email or social media</p>

        <div id="success-message" class="hidden bg-green-100 text-green-700 p-4 rounded mb-4">
            Account created successfully! Redirecting to your profile...
        </div>

        <form id="signup-form">
            <div class="mb-4">
                <label for="name" class="block text-sm font-medium text-gray-700">Full Name</label>
                <input type="text" id="name" name="name" class="mt-1 p-2 w-full border rounded focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                <p class="text-red-500 text-sm mt-1 hidden">Please enter your full name</p>
            </div>
            <div class="mb-4">
                <label for="email" class="block text-sm font-medium text-gray-700">Email</label>
                <input type="email" id="email" name="email" class="mt-1 p-2 w-full border rounded focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                <p class="text-red-500 text-sm mt-1 hidden">Please enter a valid email address</p>
            </div>
            <div class="mb-4">
                <label for="password" class="block text-sm font-medium text-gray-700">Password</label>
                <input type="password" id="password" name="password" class="mt-1 p-2 w-full border rounded focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                <p class="text-red-500 text-sm mt-1 hidden">Password must be at least 6 characters</p>
            </div>
            <div class="mb-6">
                <label for="artistType" class="block text-sm font-medium text-gray-700">Artist Type</label>
                <select id="artistType" name="artistType" class="mt-1 p-2 w-full border rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <option value="General Artist">General Artist</option>
                    <option value="Musician">Musician</option>
                    <option value="Singer">Singer</option>
                    <option value="Producer">Producer</option>
                    <option value="DJ">DJ</option>
                </select>
            </div>
            <button type="submit" class="w-full bg-blue-500 text-white p-2 rounded hover:bg-blue-600">Create Account</button>
        </form>

        <div class="mt-6 text-center">
            <p class="text-gray-600">Or sign up with</p>
            <div class="flex justify-center space-x-4 mt-4">
                <!-- Google Icon -->
                <a href="/api/auth/google" class="text-blue-500 hover:text-blue-700">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/>
                        <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23.94-3.71.94-2.87 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/>
                        <path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l3.66-2.84z" fill="#FBBC05"/>
                        <path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.29-4.53 6.16-4.53z" fill="#EA4335"/>
                    </svg>
                </a>
                <!-- Instagram Icon -->
                <a href="#" id="instagram-signup-btn" class="text-blue-500 hover:text-blue-700">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-instagram" viewBox="0 0 16 16">
                        <path d="M8 0C5.829 0 5.556.01 4.703.048 3.85.088 3.269.222 2.76.42a3.9 3.9 0 0 0-1.417.923A3.9 3.9 0 0 0 .42 2.76C.222 3.268.087 3.85.048 4.7.01 5.555 0 5.827 0 8.001c0 2.172.01 2.444.048 3.297.04.852.174 1.433.372 1.942.205.526.478.972.923 1.417.444.445.89.719 1.416.923.51.198 1.09.333 1.942.372C5.555 15.99 5.827 16 8 16s2.444-.01 3.298-.048c.851-.04 1.434-.174 1.943-.372a3.9 3.9 0 0 0 1.416-.923c.445-.445.718-.891.923-1.417.197-.509.332-1.09.372-1.942C15.99 10.445 16 10.173 16 8s-.01-2.445-.048-3.299c-.04-.851-.175-1.433-.372-1.941a3.9 3.9 0 0 0-.923-1.417A3.9 3.9 0 0 0 13.24.42c-.51-.198-1.092-.333-1.943-.372C10.443.01 10.172 0 7.998 0zm-.717 1.442h.718c2.136 0 2.389.007 3.232.046.78.035 1.204.166 1.486.275.373.145.64.319.92.599s.453.546.598.92c.11.281.24.705.275 1.485.039.843.047 1.096.047 3.231s-.008 2.389-.047 3.232c-.035.78-.166 1.203-.275 1.485a2.5 2.5 0 0 1-.599.919c-.28.28-.546.453-.92.598-.28.11-.704.24-1.485.276-.843.038-1.096.047-3.232.047s-2.39-.009-3.233-.047c-.78-.036-1.203-.166-1.485-.276a2.5 2.5 0 0 1-.92-.598 2.5 2.5 0 0 1-.6-.92c-.109-.281-.24-.705-.275-1.485-.038-.843-.046-1.096-.046-3.233s.008-2.388.046-3.231c.036-.78.166-1.204.276-1.486.145-.373.319-.64.599-.92s.546-.453.92-.598c.282-.11.705-.24 1.485-.276.738-.034 1.024-.044 2.515-.045zm4.988 1.328a.96.96 0 1 0 0 1.92.96.96 0 0 0 0-1.92m-4.27 1.122a4.109 4.109 0 1 0 0 8.217 4.109 4.109 0 0 0 0-8.217m0 1.441a2.667 2.667 0 1 1 0 5.334 2.667 2.667 0 0 1 0-5.334"/>
                    </svg>
                </a>
                <!-- X Icon -->
                <a href="/api/auth/x" class="text-blue-500 hover:text-blue-700">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z" fill="#000"/>
                    </svg>
                </a>
            </div>
        </div>

        <div class="mt-6 text-center">
            <p>Already have an account? <a href="login.html" class="text-blue-500 hover:underline">Log In</a></p>
        </div>
    </div>

    <div id="error-modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center">
        <div class="bg-white p-6 rounded-lg shadow-lg">
            <p id="error-message" class="text-red-500 mb-4"></p>
            <button id="close-modal" class="bg-blue-500 text-white px-4 py-2 rounded">OK</button>
        </div>
    </div>

    <script>
        // Check login status and toggle links
        let token = localStorage.getItem('token');
        const loginLink = document.getElementById('login-link');
        const logoutLink = document.getElementById('logout-link');
        if (token) {
            loginLink.classList.add('hidden');
            logoutLink.classList.remove('hidden');
        } else {
            loginLink.classList.remove('hidden');
            logoutLink.classList.add('hidden');
        }

        // Handle logout
        logoutLink.addEventListener('click', (e) => {
            e.preventDefault();
            localStorage.removeItem('token');
            window.location.href = '/frontend.html';
        });

        document.getElementById('signup-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const form = e.target;
            const formData = new FormData(form);
            const data = {
                name: formData.get('name'),
                email: formData.get('email'),
                password: formData.get('password'),
                artistType: formData.get('artistType'),
                role: 'artist' // Default role as per User.js
            };

            try {
                const response = await fetch('http://www.connectartist.in/api/signup', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data),
                });

                const result = await response.json();

                if (response.ok) {
                    // Store token and userId in localStorage if returned by backend
                    if (result.token && result.userId) {
                        localStorage.setItem('token', result.token);
                        localStorage.setItem('userId', result.userId);
                    }
                    // Show success message and redirect
                    document.getElementById('success-message').classList.remove('hidden');
                    setTimeout(() => {
                        window.location.href = 'frontend.html'; // Redirect to homepage
                    }, 2000);
                } else {
                    // Show error message in modal
                    document.getElementById('error-message').textContent = result.message || 'Error during signup';
                    document.getElementById('error-modal').classList.remove('hidden');
                }
            } catch (error) {
                // Network or other error
                document.getElementById('error-message').textContent = 'Network error: Could not connect to the server';
                document.getElementById('error-modal').classList.remove('hidden');
            }
        });

        // Close error modal
        document.getElementById('close-modal').addEventListener('click', () => {
            document.getElementById('error-modal').classList.add('hidden');
        });

        // Handle token from social login callback
        (function() {
            const urlParams = new URLSearchParams(window.location.search);
            const token = urlParams.get('token');
            const error = urlParams.get('error');
            if (token) {
                localStorage.setItem('token', token);
                document.getElementById('success-message').classList.remove('hidden');
                setTimeout(() => {
                    window.location.href = 'frontend.html';
                }, 2000);
            } else if (error) {
                document.getElementById('error-message').textContent = 'Instagram login failed. Please try again.';
                document.getElementById('error-modal').classList.remove('hidden');
            }
        })();

        // Instagram signup button logic
        document.getElementById('instagram-signup-btn').addEventListener('click', async function(e) {
            e.preventDefault();
            try {
                const res = await fetch('/api/auth/instagram/login-url');
                const data = await res.json();
                if (data.url) {
                    window.location.href = data.url;
                } else {
                    alert('Failed to get Instagram login URL.');
                }
            } catch (err) {
                alert('Error connecting to backend for Instagram login.');
            }
        });
    </script>
</body>
</html>